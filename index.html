<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Share Expenses</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="bower_components/react/react.js"></script>
    <script src="bower_components/react/JSXTransformer.js"></script>
    <script src="bower_components/lodash/lodash.min.js"></script>
  </head>
  <body>
    <div class="container" id="main">
      <h1>Share Expenses</h1>
      <div id="share-app">
      </div>
    </div>
    <script type="text/jsx">
      'use strict';

      var ShareApp = React.createClass ({
        render: function () {
          return (
            <div>
              <div className="row">
                <UserList users={this.props.users} />
                <ExpenseList users={this.props.users} _users={this.props._users} expenses={this.props.expenses} />
                <TotalList users={this.props.users} _users={this.props._users} />
              </div>
            </div>
          );
        }
      });

      var UserList = React.createClass ({
        render: function () {
          var userList = this.props.users.map (function (user) {
            return (
              <li className="list-group-item" key={user.key}>{user.name}</li>
            );
          });
          return (
            <div className="col-lg-3">
              <div className="panel panel-info">
                <div className="panel-heading">Users</div>
                <ul className="list-group">
                  {userList}
                </ul>
              </div>
            </div>
          );
        }
      });

      var ExpenseList = React.createClass ({
        render: function () {
          var that = this;
          var expenseList = this.props.expenses.map (function (expense) {
            return (<ExpenseItem users={that.props.users} _users={that.props._users} expense={expense}/>);
          });
          return (
            <div className="col-lg-4">
              <div className="panel panel-info">
                <div className="panel-heading">Expenses</div>
                <ul className="list-group">
                  {expenseList}
                </ul>
              </div>
            </div>
          );
        }
      });

      var ExpenseItem = React.createClass ({
        render: function () {
          var expense = this.props.expense;
          var userName = this.props._users[expense.payer].name;
          var users = this.props.users.map (function (user) {
            return (
              <div className="checkbox">
                <label>
                  <input type="checkbox" />
                  {user.name}
                </label>
              </div>
            );
          });
          return (
            <li className="list-group-item">
              <p>
                <b>Amount:</b>
              </p>
              <input type="text" className="form-control" defaultValue={expense.amount} placeholder="Amount"/>
              <hr />
              <p>
                <b>Paid by:</b>
              </p>
              <span>{userName}</span>
              <hr />
              <p>
                <b>Share between:</b>
              </p>
              {users}
            </li>
          );
        }
      });

      var TotalList = React.createClass ({
        render: function () {
          var that = this;
          var totals = [];
          this.props.users.forEach (function (ower) {
            that.props.users.forEach (function (owed) {
              totals.push (
                <li className="list-group-item">{ower.name} owes â‚¬X to {owed.name}</li>
              );
            });
          });
          return (
            <div className="col-lg-4">
              <div className="panel panel-info">
                <div className="panel-heading">Summary</div>
                <ul className="list-group">
                  {totals}
                </ul>
              </div>
            </div>
          );
        }
      });

      var index = 0;
      var USERS = [{
        key: index++,
        name: 'Antoine'
      }, {
        key: index++,
        name: 'Jojo'
      }, {
        key: index++,
        name: 'Vincent'
      }, {
        key: index++,
        name: 'Alex'
      }];
      var _USERS = _.indexBy (USERS, 'key');

      var EXPENSES = [{
        key: Math.random (),
        amount: 19.95,
        payer: 2
      }, {
        key: Math.random (),
        amount: 29.95,
        payer: 3
      }];

      React.render (
      <ShareApp users={USERS} _users={_USERS} expenses={EXPENSES}/>,
        document.getElementById ('share-app')
      );
    </script>
  </body>
</html>
